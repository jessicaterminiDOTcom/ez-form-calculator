jQuery(document).ready(function(a){function d(c){var d=0;return a(c).find(".ezfc-custom-element").each(function(f,g){var h=a(c).data("id"),i=a(g),j=a(g).data("element");if(!a(this).hasClass("ezfc-hidden")||"subtotal"==j||"hidden"==j){var l=i.data("value_external");if(l&&a(l).length>0){var m=a(l).val();"input"==j||"numbers"==j||"subtotal"==j?i.find("input").val(m):"dropdown"==j?(i.find(":selected").removeAttr("selected"),i.find("option[value='"+m+"']").attr("selected","selected")):"radio"==j?(i.find(":checked").removeAttr("checked"),i.find("input[value='"+m+"']").attr("checked","checked")):"checkbox"==j&&(i.find(":checked").removeAttr("checked"),i.find("input[value='"+m+"']").attr("checked","checked")),b[h][l]||(b[h][l]=1,a(l).on("change keyup",function(){e(a(c))}))}var n=i.data("conditional_action"),o=i.data("conditional_operator"),p=i.data("conditional_target"),q=i.data("conditional_values"),r=i.data("conditional_notoggle");if(n&&0!=n){var s=n.toString().split(","),t=o.toString().split(","),u=p.toString().split(","),v=q.toString().split(","),w=r.toString().split(","),x=parseFloat(i.val());if("input"==j||"numbers"==j||"subtotal"==j)x=parseFloat(i.find("input").val());else if("dropdown"==j)x=parseFloat(i.find(":selected").data("value"));else if("radio"==j)x=parseFloat(i.find(":checked").data("value"));else if("checkbox"==j)x=0,i.find(":checked").each(function(b,c){x+=parseFloat(a(c).data("value"))});else if("daterange"==j){var y=[a(i).find(".ezfc-element-daterange-from").datepicker("getDate"),a(i).find(".ezfc-element-daterange-to").datepicker("getDate")];x=k(y[0],y[1])}a.each(s,function(b,c){var d=a("#ezfc_element-"+u[b]);if(!(d.length<1)){var e;e="input"==j?v[b]:parseFloat(v[b]);var f;if("input"==j)f=e.toLowerCase()==e.toLowerCase();else switch(t[b]){case"gr":f=x>e;break;case"gre":f=x>=e;break;case"less":f=e>x;break;case"lesse":f=e>=x;break;case"equals":f=x==e;break;case"between":var g=v[b].split(":");f=g.length<2?!1:x>=g[0]&&x<=g[1];break;default:f=!1}var h,i;"show"==c?(h="removeClass",i="addClass"):(h="addClass",i="removeClass");var k=w[b];f?d[h]("ezfc-hidden ezfc-custom-hidden"):1!=k&&d[i]("ezfc-hidden ezfc-custom-hidden")}})}var z=i.data("calculate_enabled")||"",A=i.data("calculate_operator")||"",B=i.data("calculate_target")||"",C=i.data("calculate_values")||"",D=i.data("overwrite_price")||"",E=i.find(".ezfc-element-numbers, .ezfc-element-input-hidden, .ezfc-element-subtotal, .ezfc-element-daterange-container, :selected, :checked");a(E).each(function(b,c){if(z&&"0"!=z||B&&"0"!=B||C&&"0"!=C||"subtotal"==j||"hidden"==j){var e=parseFloat(a(c).data("factor")),f=parseFloat(a(c).val());(!f||isNaN(f))&&(f=0),e&&!isNaN(e)||0===e||(e=1);var h=f;switch(a(g).data("element")){case"numbers":case"hidden":h=f*e;break;case"dropdown":case"radio":case"checkbox":h=parseFloat(a(c).data("value")),isNaN(h)&&(h=0);break;case"subtotal":h=d;break;case"daterange":var i=[a(c).find(".ezfc-element-daterange-from").datepicker("getDate"),a(c).find(".ezfc-element-daterange-to").datepicker("getDate")];h=k(i[0],i[1])*e}var l=A.toString().split(",");calc_target_elements=B.toString().split(","),calc_custom_values=C.toString().split(","),l.length>0&&0!=l[0]&&a.each(l,function(b,d){var e=a("#ezfc_element-"+calc_target_elements[b]),i=calc_custom_values[b];if(e.length<1&&(!i||"0"==i))return!1;var j;if(e.length>0){var l=e.data("element");if("numbers"==l||"subtotal"==l||"hidden"==l){var m=e.find("input"),n=parseFloat(m.data("factor"));(!n||isNaN(n))&&(n=1),j=parseFloat(m.val())*n}else if("dropdown"==l)j=parseFloat(e.find(":selected").data("value"));else if("radio"==l)j=parseFloat(e.find(":checked").data("value"));else if("checkbox"==l)j=0,e.find(":checked").each(function(b,c){j+=parseFloat(a(c).data("value"))});else if("daterange"==l){var o=[a(e).find(".ezfc-element-daterange-from").datepicker("getDate"),a(e).find(".ezfc-element-daterange-to").datepicker("getDate")];j=k(o[0],o[1])}}else"0"!=i&&(j=i);switch((!j||isNaN(j))&&(j=0),d){case"add":h+=j;break;case"subtract":h-=j;break;case"multiply":h*=j;break;case"divide":if(0==j)return;h/=j,"1"==a(c).data("calculate_before")&&(D=1,h=j/f);break;case"equals":h=j,a(g).find("input").val(h);break;case"power":h=Math.pow(h,j)}}),"1"==D?d=h:"1"==z&&(d+=h),"subtotal"==j&&a(g).find("input").val(d.toFixed(2))}});var F=i.data("discount_range_min"),G=i.data("discount_range_max"),H=i.data("discount_operator"),I=i.data("discount_values");if(I){var J=F.toString().split(","),K=G.toString().split(","),L=H.toString().split(","),M=I.toString().split(","),x=0,N=1;if("input"==j||"numbers"==j||"subtotal"==j||"hidden"==j){var O=i.find("input");N=parseFloat(O.data("factor")),N&&!isNaN(N)||0===N||(N=1),x=parseFloat(O.val())}else if("dropdown"==j)x=parseFloat(i.find(":selected").data("value"));else if("radio"==j)x=parseFloat(i.find(":checked").data("value"));else if("checkbox"==j)x=0,i.find(":checked").each(function(b,c){x+=parseFloat(a(c).data("value"))});else if("daterange"==calc_target_element){var y=[a(calc_target).find(".ezfc-element-daterange-from").datepicker("getDate"),a(calc_target).find(".ezfc-element-daterange-to").datepicker("getDate")];x=k(y[0],y[1])}a.each(L,function(b,c){J[b]||0===J[b]||(J[b]=Number.NEGATIVE_INFINITY),K[b]||0===K[b]||(K[b]=Number.POSITIVE_INFINITY);var e;if(x>=parseFloat(J[b])&&x<=parseFloat(K[b])){var g,f=parseFloat(M[b]);switch(c){case"add":g=f,e=g,d+=e;break;case"subtract":g=f,e=g,d-=e;break;case"percent_add":g=x*N*(f/100),e=d+g,d=e;break;case"percent_sub":g=x*N*(f/100),e=d-g,d=e;break;case"equals":g=f,e=g,d=e}"subtotal"==j&&a(i).find("input").val(e.toFixed(2))}})}}}),d}function e(b){var c=a(b).data("currency"),e=a(b).data("id"),h=d(a(b)),i=f(e,h,c);g(a(b)),a(b).find(".ezfc-price").text(i)}function f(a,b,d){var e=c;ezfc_form_vars[a].price_format&&ezfc_form_vars[a].price_format.length>0&&(e=ezfc_form_vars[a].price_format);var b=numeral(b).format(e);return b=0==ezfc_form_vars[a].currency_position?d+" "+b:b+" "+d}function g(b){a(b).find("[data-element='subtotal']").each(function(c,d){var e=a(d).find(".ezfc-element-subtotal").val(),g=f(a(b).data("id"),e,a(b).data("currency"));a(d).find(".ezfc-text").text(g)})}function h(){a(".ezfc-fixed-price").each(function(){var b=a(this).offset(),c=a(this).data("id"),d=a(".ezfc-form[data-id='"+c+"']"),e=d.outerHeight(),f=d.offset(),g=a(window).scrollTop(),h=f.top-g;0>h&&h>-e&&a(this).offset({top:g}),h>0&&b.top>f.top&&a(this).offset({top:f.top})})}function i(b){a(b).find(".ezfc-custom-hidden").each(function(){a.each(a(this).find("input, :selected"),function(){a(this).val(a(this).data("initvalue")).removeAttr("disabled")})})}function j(b,c){var d=parseInt(b.find(".ezfc-step-active").data("step")),e=b.find("[data-step='"+d+"']");return e.fadeOut(200,function(){b.find("[data-step='"+c+"']").fadeIn(200).addClass("ezfc-step-active"),a(this).removeClass("ezfc-step-active")}),!1}function k(a,b){return a&&b?(b-a)/1e3/60/60/24:0}var b=[],c=ezfc_vars.price_format?ezfc_vars.price_format:"0,0[.]00";numeral.defaultFormat(c),a.datepicker.setDefaults(a.datepicker.regional[ezfc_vars.datepicker_language]),a(".ezfc-form").each(function(){var c=this,d=a(this).data("id");b[d]=[],a(this).find(".ezfc-element-datepicker").datepicker({dateFormat:ezfc_form_vars[d].datepicker_format}),a(this).find(".ezfc-element-timepicker").timepicker({timeFormat:ezfc_form_vars[d].timepicker_format}),a(this).find(".ezfc-element-daterange").each(function(){var b=ezfc_form_vars[d].datepicker_format,f=this;a(this).hasClass("ezfc-element-daterange-from")?a(this).datepicker({dateFormat:b,minDate:a(this).data("mindate"),maxDate:a(this).data("maxdate"),onSelect:function(d){var g=a(this).data("mindays")||0,h=a.datepicker.parseDate(b,d);h.setDate(h.getDate()+g),a(f).siblings(".ezfc-element-daterange-to").datepicker("option","minDate",h),e(c)}}):a(this).datepicker({dateFormat:ezfc_form_vars[d].datepicker_format,minDate:a(this).data("mindate"),maxDate:a(this).data("maxdate"),onSelect:function(d){var g=a(this).data("mindays")||0,h=a.datepicker.parseDate(b,d);h.setDate(h.getDate()-g),a(f).siblings(".ezfc-element-daterange-from").datepicker("option","maxDate",h),e(c)}})});var f=a(this).find(".ezfc-step");if(f.length>0){var g=f.last();a(this).find(".ezfc-submit-wrapper").appendTo(g).addClass("ezfc-submit-step")}e(a(this)),e(a(this))}),a(".ezfc-element-fileupload").each(function(b,c){var d=a(this).parents(".ezfc-element"),e=a(d).find(".ezfc-upload-button");a(this).fileupload({dataType:"json",add:function(b,f){a(d).find(".ezfc-bar").css("width",0),a(d).find(".progress").addClass("active"),a(d).find(".ezfc-fileupload-message").text(""),e.click(function(){return""==a(c).val()?!1:(f.submit(),a(e).attr("disabled","disabled"),b.preventDefault(),!1)})},done:function(b,c){return c.result.error?(a(e).removeAttr("disabled"),a(d).find(".ezfc-fileupload-message").text(c.result.error),a(d).find(".ezfc-bar").css("width",0),!1):(a(this).attr("multiple")&&(a(this).val(""),a(e).removeAttr("disabled")),a(d).find(".progress").removeClass("active"),a(d).find(".ezfc-fileupload-message").text(ezfc_vars.upload_success),void 0)},progressall:function(b,c){var e=parseInt(100*(c.loaded/c.total),10);a(d).find(".ezfc-bar").css("width",e+"%")},replaceFileInput:!1,url:ezfc_ajaxurl_fileupload})}),a(".ezfc-overview").dialog({autoOpen:!1,modal:!0}),a(".ezfc-form input, .ezfc-form select").on("change keyup",function(){e(a(this).parents(".ezfc-form"))}),a(".ezfc-slider").each(function(b,c){var d=a(this);a(c).parents(".ezfc-element").find(".ezfc-slider-element").slider({min:d.data("min"),max:d.data("max"),step:d.data("stepsslider")||1,value:d.val()||0,slide:function(a,b){d.val(b.value)},stop:function(){d.trigger("change")}}),a(this).draggable()}),a(".ezfc-spinner").each(function(){var d=a(this);d.spinner({min:d.data("min"),max:d.data("max"),step:d.data("stepsspinner"),change:function(){d.trigger("change")},spin:function(a,b){d.val(b.value),d.trigger("change")}})}),a(".ezfc-step-button").on("click",function(){var b=a(this).parents(".ezfc-form"),c=parseInt(b.find(".ezfc-step-active").data("step")),d=c+(a(this).hasClass("ezfc-step-next")?1:-1);return j(b,d),!1}),a(window).scroll(function(){h()}),h(),a(".ezfc-form").submit(function(b){var c=a(this);a(".ezfc-loading").show();var d=a(c).find(".ezfc-submit-icon");d.fadeIn();var e=a(c).find("input[type='submit']");e.attr("disabled","disabled"),a(this).find(".ezfc-custom-hidden").each(function(){a(this).find("input").val("__HIDDEN__"),a(this).find(":selected").val("__HIDDEN__");var b=a(this).find(".ezfc-element-radio:not(:has(:radio:checked))");b.length&&a(b).first().find("input").prop("checked",!0)});var f=a(this).data("id"),g="id="+f+"&"+a(this).serialize();return a.ajax({type:"post",url:ezfc_ajaxurl,data:{action:"ezfc_frontend",data:g},success:function(b){if(a(".ezfc-loading").hide(),e.removeAttr("disabled"),d.fadeOut(),"1"==ezfc_vars.debug_mode&&console.log(b),b=a.parseJSON(b),!b)return a(c).find(".ezfc-message").text("Something went wrong. :("),"undefined"!=typeof Recaptcha&&Recaptcha.reload(),i(c),!1;if(b.error){if(i(c),b.id){var g="#ezfc_element-"+b.id,h=a(g).find(".ezfc-element").first(),k=a(c).find(".ezfc-step-active").length>0?!0:!1;if(k){var l=parseInt(a(g).parents(".ezfc-step").data("step"));j(c,l)}h.length>0?a(h).opentip(b.error,{delay:800,hideDelay:.1,hideTriggers:["closeButton","target"],removeElementsOnHide:!0,showOn:null,target:g+" label",targetJoint:"top left",tipJoint:"bottom"}).show():alarm(b.error)}else{var n=a(c).parents(".ezfc-wrapper").find(".ezfc-message");n.text(b.error).fadeIn(),setTimeout(function(){n.fadeOut()},7500)}return"undefined"!=typeof Recaptcha&&Recaptcha.reload(),!1}"undefined"!=typeof Recaptcha&&Recaptcha.reload(),b.paypal?(e.attr("disabled","disabled"),window.location=b.paypal):(ezfc_form_vars[f]&&ezfc_form_vars[f].hide_all_forms&&1==ezfc_form_vars[f].hide_all_forms?a(".ezfc-form, .ezfc-required-notification").fadeOut():a(".ezfc-form[data-id='"+f+"'], .ezfc-required-notification").fadeOut(),a(".ezfc-success-text[data-id='"+f+"']").fadeIn(),ezfc_form_vars[f]&&ezfc_form_vars[f].redirect_url&&ezfc_form_vars[f].redirect_url.length>0&&window.location.replace(ezfc_form_vars[f].redirect_url))}}),b.preventDefault(),!1})});